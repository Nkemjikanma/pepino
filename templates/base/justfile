# Default recipe - show available commands
<<<<<<< HEAD

=======
>>>>>>> main
default:
	@just --list

# Start PostgreSQL in Docker
db-up:
	@echo "ğŸ˜ Starting PostgreSQL..."
	cd server && docker compose up -d
	@echo "â³ Waiting for database to be ready..."
	@sleep 3
	@echo "âœ… PostgreSQL is ready!"

# Stop PostgreSQL
db-down:
	@echo "ğŸ›‘ Stopping PostgreSQL..."
	docker-compose down
	@echo "âœ… PostgreSQL stopped"

# install dependencies
install:
	@echo "ğŸ“¦ Installing server dependencies..."
	cd server && cargo build
	@echo "ğŸ“¦ Installing client dependencies..."
	cd client && npm install
	@echo "âœ… Dependencies installed!"

# Create database if it doesn't exist and run migrations
migrate:
	@echo "ğŸ“ Creating database (if needed)..."
	cd server && sqlx database create || true
	@echo "ğŸ“ Running migrations..."
	cd server && sqlx migrate run
	@echo "âœ… Migrations complete!"


# Generate TS types from Rust
generate-types:
	typeshare ./server/src --lang=typescript --output-file=./client/src/types/api.ts


# start dev servers - run in seperate terminals
# How do I make them run in seperate terminals?
dev-server:
	@echo "ğŸ¦€ Starting Rust backend..."
	cd server && cargo watch -x run


dev-client:
	@echo "âš¡ Starting Vite frontend..."
	cd client && npm run dev


# build for prod
build:
	@echo "ğŸ—ï¸  Building for production..."
	cd client && npm run build
	cd server && cargo build --release
	@echo "âœ… Production build complete!"


# clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -rf server/target client/dist client/node_modules
	@echo "âœ… Cleanup complete!"

# run server tests
test:
	cd server && cargo test
